{"version":3,"sources":["webpack://StorageEmitter/webpack/universalModuleDefinition","webpack://StorageEmitter/webpack/startup","webpack://StorageEmitter/./src/index.ts"],"names":["root","factory","exports","module","define","amd","self","__webpack_exports__","__spreadArray","this","to","from","i","il","length","j","Object","defineProperty","value","EventName","callbacks","emit","event","args","_i","arguments","cbs","len","slice","apply","StorageEmitter","_this","window","addEventListener","ev","key","newValue","test","replace","JSON","parse","call","error","localStorage","setItem","Date","now","prototype","on","fn","push","off","cb","splice","offall","once","stringify","emits","default"],"mappings":"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","file":"storageemitter-js.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StorageEmitter\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StorageEmitter\"] = factory();\n\telse\n\t\troot[\"StorageEmitter\"] = factory();\n})(self, function() {\nreturn ","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = {};\n__webpack_modules__[991](0, __webpack_exports__);\n","\"use strict\";\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar EventName = \"emitter&\";\nvar callbacks = {};\nfunction emit(event) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    var cbs = callbacks[event];\n    if (cbs) {\n        cbs = cbs.slice(0);\n        for (var i = 0, len = cbs.length; i < len; ++i) {\n            cbs[i].apply(this, args);\n        }\n    }\n}\nvar StorageEmitter = /** @class */ (function () {\n    function StorageEmitter() {\n        var _this = this;\n        window.addEventListener(\"storage\", function (ev) {\n            var key = ev.key + \"\", value = ev.newValue + \"\";\n            if (/^emitter&/.test(key) && /^\\[.*]$/.test(value)) {\n                try {\n                    var event = key.replace(/^emitter&/, \"\");\n                    var args = JSON.parse(value);\n                    emit.call.apply(emit, __spreadArray([_this, event], args));\n                }\n                catch (error) {\n                }\n                localStorage.setItem(key, Date.now() + \"\");\n            }\n        }, true);\n    }\n    /**\n     * 在当前页面绑定一个监听器\n     * @param event\n     * @param fn\n     */\n    StorageEmitter.prototype.on = function (event, fn) {\n        (callbacks[event] = callbacks[event] || []).push(fn);\n        return this;\n    };\n    /**\n     * 关闭当前页面的指定监听器\n     * @param event\n     * @param fn\n     */\n    StorageEmitter.prototype.off = function (event, fn) {\n        var cbs = callbacks[event];\n        if (!cbs)\n            return this;\n        if (!fn) {\n            delete callbacks[event];\n            return this;\n        }\n        var cb = {};\n        for (var i = 0; i < cbs.length; i++) {\n            cb = cbs[i];\n            if (cb === fn || cb.fn === fn) {\n                cbs.splice(i, 1);\n                break;\n            }\n        }\n        return this;\n    };\n    /**\n     * 关闭当前页面的所有监听器\n     */\n    StorageEmitter.prototype.offall = function () {\n        callbacks = {};\n        return this;\n    };\n    /**\n     * 在当前页面注册一次性的监听器\n     * @param event\n     * @param fn\n     */\n    StorageEmitter.prototype.once = function (event, fn) {\n        var self = this;\n        function on() {\n            self.off(event);\n            fn.apply(this, arguments);\n        }\n        on.fn = fn;\n        this.on(event, on);\n        return this;\n    };\n    /**\n     * 触发自己以外的同源网页的监听事件\n     * @param event\n     * @param args\n     */\n    StorageEmitter.prototype.emit = function (event) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        localStorage.setItem(EventName + event, JSON.stringify(args));\n        return this;\n    };\n    /**\n     * 触发所有的同源网页的监听事件\n     * @param event\n     * @param args\n     */\n    StorageEmitter.prototype.emits = function (event) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        emit.call.apply(emit, __spreadArray([this, event], args));\n        localStorage.setItem(EventName + event, JSON.stringify(args));\n        return this;\n    };\n    return StorageEmitter;\n}());\nexports.default = new StorageEmitter();\n"],"sourceRoot":""}